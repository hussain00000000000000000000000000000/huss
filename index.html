<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ù…ÙˆØ§Ø¯ÙÙƒ | Ø§Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --primary: #0e3d59; --accent: #d4af37; --bg: #f8fafb;
            --white: #ffffff; --green: #2ecc71; --red: #e74c3c;
            --text: #2c3e50; --shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; direction: rtl; }
        
        header { 
            background: var(--primary); color: white; padding: 15px; text-align: center; 
            border-bottom: 4px solid var(--accent); position: sticky; top: 0; z-index: 1000;
        }
        .eng-section { background: #111; color: var(--accent); margin: 10px; padding: 10px; border-radius: 8px; text-align: center; font-size: 14px; font-weight: bold; }

        .tabs-container { 
            display: flex; overflow-x: auto; background: white; padding: 12px; gap: 8px; 
            box-shadow: var(--shadow); position: sticky; top: 65px; z-index: 999;
        }
        .tabs-container::-webkit-scrollbar { display: none; }
        .tab-btn { 
            background: #f0f2f5; border: none; padding: 8px 18px; border-radius: 20px; 
            font-family: 'Cairo'; font-size: 12px; font-weight: bold; white-space: nowrap; cursor: pointer; 
        }
        .tab-btn.active { background: var(--primary); color: white; }

        .view-section { display: none; padding: 15px; animation: fadeIn 0.3s; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card { background: white; border-radius: 12px; overflow: hidden; box-shadow: var(--shadow); border: 1px solid #eee; position: relative; }
        .card img { width: 100%; height: 120px; object-fit: cover; background: #eee; }
        .card-body { padding: 10px; }
        .p-name { font-size: 12px; font-weight: bold; height: 35px; overflow: hidden; }
        .p-price-num { color: var(--red); font-weight: 900; font-size: 15px; display: block; }
        .p-price-text { color: #2980b9; font-size: 10px; font-weight: bold; display: block; }

        .form-container { background: white; padding: 25px; border-radius: 20px; box-shadow: var(--shadow); max-width: 500px; margin: 0 auto; }
        .input-group { position: relative; margin-bottom: 15px; text-align: right; }
        .input-group label { display: block; font-size: 13px; font-weight: bold; color: var(--primary); margin-bottom: 5px; }
        
        input, select, textarea { 
            width: 100%; padding: 14px; border: 1px solid #e0e0e0; border-radius: 12px; 
            font-family: 'Cairo'; outline: none; background: #fafafa; font-size: 14px;
            transition: 0.3s; box-sizing: border-box;
        }

        .upload-area { 
            border: 2px dashed #d0d7de; padding: 25px; text-align: center; border-radius: 15px; 
            cursor: pointer; background: #fdfdfd; transition: 0.3s; margin-top: 10px;
        }
        #imagePreview { width: 120px; height: 120px; object-fit: cover; margin: 15px auto 0; border-radius: 12px; border: 2px solid #eee; display: none; }

        .btn-submit { 
            background: var(--green); color: white; border: none; width: 100%; padding: 16px; 
            border-radius: 12px; font-weight: 900; font-size: 16px; cursor: pointer; 
            margin-top: 20px; box-shadow: 0 4px 10px rgba(46, 204, 113, 0.3);
        }

        .auth-container { background: white; padding: 25px; border-radius: 20px; box-shadow: var(--shadow); max-width: 500px; margin: 10px auto; }
        .role-selector { display: flex; gap: 5px; margin-bottom: 20px; background: #f0f2f5; padding: 5px; border-radius: 10px; }
        .role-btn { flex: 1; padding: 10px; font-size: 12px; border: none; border-radius: 8px; cursor: pointer; font-family: 'Cairo'; font-weight: bold; transition: 0.3s; }
        .role-btn.active { background: var(--primary); color: white; }
        
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #eee; z-index: 2000; }
        .nav-item { text-align: center; font-size: 10px; color: #999; cursor: pointer; flex: 1; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        .nav-item span { font-size: 20px; display: block; }
        .delete-btn { position: absolute; top: 5px; left: 5px; background: var(--red); color: white; border: none; border-radius: 5px; padding: 3px 7px; font-size: 10px; cursor: pointer; z-index: 100;}
    </style>
</head>
<body>

<header><h1>Ù…ÙˆØ§Ø¯ÙÙƒ <span>Ø§Ù„Ø¹Ø±Ø§Ù‚</span></h1></header>
<div class="eng-section">ğŸ“ Ù…Ù†ØµØ© Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ÙŠÙ† ÙˆØ§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† ÙˆØ§Ù„Ø²Ø¨Ø§Ø¦Ù†</div>

<div id="homeView" class="view-section active">
    <div class="tabs-container" id="tabsMenu">
        <button class="tab-btn active" onclick="filterData('Ø§Ù„ÙƒÙ„', this)">Ø§Ù„ÙƒÙ„</button>
        <button class="tab-btn" onclick="filterData('Ø¨Ù†Ø§Ø¡', this)">Ø¨Ù†Ø§Ø¡</button>
        <button class="tab-btn" onclick="filterData('ØªØ³Ù„ÙŠØ­', this)">ØªØ³Ù„ÙŠØ­</button>
        <button class="tab-btn" onclick="filterData('Ø³ÙŠØ±Ø§Ù…ÙŠÙƒ', this)">Ø³ÙŠØ±Ø§Ù…ÙŠÙƒ</button>
        <button class="tab-btn" onclick="filterData('ØµØ­ÙŠØ§Øª', this)">ØµØ­ÙŠØ§Øª</button>
        <button class="tab-btn" onclick="filterData('ÙƒÙ‡Ø±Ø¨Ø§Ø¡', this)">ÙƒÙ‡Ø±Ø¨Ø§Ø¡</button>
        <button class="tab-btn" onclick="filterData('Ø£ØµØ¨Ø§Øº', this)">Ø£ØµØ¨Ø§Øº</button>
        <button class="tab-btn" onclick="filterData('Ø¥Ù†Ø´Ø§Ø¦ÙŠØ©', this)">Ø¥Ù†Ø´Ø§Ø¦ÙŠØ©</button>
        <button class="tab-btn" onclick="filterData('Ù…Ø¨ÙŠØ¯Ø§Øª', this)">Ù…Ø¨ÙŠØ¯Ø§Øª</button>
        <button class="tab-btn" onclick="filterData('Ø´Ø¨Ø§Ø¨ÙŠÙƒ', this)">Ø´Ø¨Ø§Ø¨ÙŠÙƒ</button>
    </div>
    <div class="grid" id="mainGrid" style="margin-top:15px;"></div>
</div>

<div id="supplierView" class="view-section">
    <div class="form-container">
        <h3 style="margin:0 0 20px; text-align: center; color: var(--primary);">ğŸ“¥ Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø³ÙˆÙ‚</h3>
        <div class="input-group">
            <label>ğŸ“¦ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</label>
            <input type="text" id="pName" placeholder="Ù…Ø«Ø§Ù„: Ø³Ù…Ù†Øª Ù…Ù‚Ø§ÙˆÙ… Ù„Ù„Ø±Ø·ÙˆØ¨Ø©">
        </div>
        <div class="input-group">
            <label>ğŸ’° Ø§Ù„Ø³Ø¹Ø± (Ø¯ÙŠÙ†Ø§Ø± Ø¹Ø±Ø§Ù‚ÙŠ)</label>
            <input type="number" id="pPrice" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·">
        </div>
        <div class="input-group">
            <label>ğŸ“‚ ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ø§Ø¯Ø©</label>
            <select id="pCat">
                <option>Ø¨Ù†Ø§Ø¡</option><option>ØªØ³Ù„ÙŠØ­</option><option>Ø³ÙŠØ±Ø§Ù…ÙŠÙƒ</option>
                <option>ØµØ­ÙŠØ§Øª</option><option>ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option><option>Ø£ØµØ¨Ø§Øº</option>
                <option>Ø¥Ù†Ø´Ø§Ø¦ÙŠØ©</option><option>Ù…Ø¨ÙŠØ¯Ø§Øª</option><option>Ø´Ø¨Ø§Ø¨ÙŠÙƒ</option>
            </select>
        </div>
        <div class="upload-area" onclick="document.getElementById('pImgFile').click()">
            <span style="font-size: 24px; display: block;">ğŸ“¸</span>
            <span style="font-weight: bold; color: #555;">Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬</span>
            <input type="file" id="pImgFile" accept="image/*" style="display:none" onchange="previewAndResizeImage(this)">
            <img id="imagePreview" src="">
        </div>
        <button class="btn-submit" id="submitBtn" onclick="addProduct()">Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ</button>
    </div>
    <h3 style="margin:30px 0 15px; border-right: 4px solid var(--accent); padding-right: 10px;">ğŸ› ï¸ Ù…ÙˆØ§Ø¯Ùƒ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
    <div class="grid" id="adminGrid"></div>
</div>

<div id="authView" class="view-section">
    <div class="auth-container">
        <h3 style="margin:0 0 20px; text-align: center; color: var(--primary);">ğŸ‘¤ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø´Ø®ØµÙŠ</h3>
        <div class="role-selector">
            <button class="role-btn active" id="role-customer" onclick="setRole('customer', this)">Ø²Ø¨ÙˆÙ†</button>
            <button class="role-btn" id="role-engineer" onclick="setRole('engineer', this)">Ù…Ù‡Ù†Ø¯Ø³</button>
            <button class="role-btn" id="role-supplier" onclick="setRole('supplier', this)">Ù…ÙˆØ±Ø¯ Ù…ÙˆØ§Ø¯</button>
        </div>
        <div class="input-group"><label>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label><input type="text" id="userName"></div>
        <div class="input-group"><label>ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label><input type="tel" id="userPhone"></div>
        <div class="input-group"><label>ğŸ“ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label><select id="userCity"><option>Ø¨ØºØ¯Ø§Ø¯</option><option>Ø§Ù„Ø¨ØµØ±Ø©</option><option>Ø¨Ø§Ø¨Ù„</option><option>Ø§Ù„Ù†Ø¬Ù</option><option>Ù†ÙŠÙ†ÙˆÙ‰</option></select></div>
        <div class="input-group"><label>ğŸ  Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label><textarea id="userAddress"></textarea></div>
        <div id="businessDetails" style="display: none;"><div class="input-group"><label>ğŸ—ï¸ Ø§Ù„Ø´Ø±ÙƒØ©</label><input type="text" id="businessName"></div></div>
        <button class="btn-submit" onclick="saveAccount()">Ø­ÙØ¸ ÙˆØ¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
        <p id="saveMsg" style="color: var(--green); display: none;">âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!</p>
    </div>
</div>

<div id="adminOrdersView" class="view-section">
    <h3 style="border-right: 4px solid var(--accent); padding-right: 10px;">ğŸ“¥ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø²Ø¨Ø§Ø¦Ù† Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</h3>
    <div id="ordersList"></div>
</div>

<div class="bottom-nav">
    <div class="nav-item active" onclick="switchView('homeView', this)"><span>ğŸ </span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
    <div class="nav-item" onclick="switchView('supplierView', this)"><span>âš™ï¸</span>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
    <div class="nav-item" onclick="switchView('adminOrdersView', this)"><span>ğŸ“‹</span>Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
    <div class="nav-item" onclick="switchView('authView', this)"><span>ğŸ‘¤</span>Ø­Ø³Ø§Ø¨ÙŠ</div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyA6PC-y6wO1Lv8Hjgi...", // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¶Ø¹ Ø§Ù„ÙƒÙˆØ¯ ÙƒØ§Ù…Ù„Ø§Ù‹ Ù‡Ù†Ø§
        authDomain: "hussain-e8703.firebaseapp.com",
        databaseURL: "https://hussain-e8703-default-rtdb.firebaseio.com/",
        projectId: "hussain-e8703",
        storageBucket: "hussain-e8703.appspot.com",
        messagingSenderId: "1071985338140",
        appId: "1:1071985338140:web:968f86f76527b140da662e"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let state = {
        products: [],
        orders: [],
        account: JSON.parse(localStorage.getItem('m_account')) || { role: 'customer' },
        tempImg: "",
        currentFilter: 'Ø§Ù„ÙƒÙ„'
    };

    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    db.ref('products').on('value', (s) => {
        const val = s.val();
        state.products = val ? Object.keys(val).map(key => ({...val[key], id: key})) : [];
        render(state.currentFilter);
    });

    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
    db.ref('orders').on('value', (s) => {
        const val = s.val();
        state.orders = val ? Object.keys(val).map(key => ({...val[key], id: key})) : [];
        renderOrders();
    });

    function previewAndResizeImage(input) {
        if (input.files && input.files[0]) {
            let r = new FileReader();
            r.onload = e => {
                let img = new Image();
                img.onload = function() {
                    let canvas = document.createElement('canvas');
                    let maxW = 400; 
                    let scale = maxW / img.width;
                    canvas.width = maxW;
                    canvas.height = img.height * scale;
                    let ctx = canvas.getContext("2d");
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    state.tempImg = canvas.toDataURL("image/jpeg", 0.5); // ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¬ÙˆØ¯Ø© Ù„Ø¶Ù…Ø§Ù† Ø³Ø±Ø¹Ø© Ø§Ù„Ù†Ø´Ø±
                    document.getElementById('imagePreview').src = state.tempImg;
                    document.getElementById('imagePreview').style.display = "block";
                };
                img.src = e.target.result;
            };
            r.readAsDataURL(input.files[0]);
        }
    }

    function addProduct() {
        const n = document.getElementById('pName').value, 
              p = document.getElementById('pPrice').value, 
              c = document.getElementById('pCat').value;
        const btn = document.getElementById('submitBtn');

        if(n && p) {
            btn.disabled = true; btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...";
            const newPostKey = db.ref().child('products').push().key;
            const finalImg = state.tempImg || "https://via.placeholder.com/300x200?text=No+Image";
            
            db.ref('products/' + newPostKey).set({
                id: newPostKey, name:n, price:Number(p), cat:c, img:finalImg
            })
            .then(() => {
                alert("âœ… ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­!");
                document.getElementById('pName').value = ""; 
                document.getElementById('pPrice').value = "";
                document.getElementById('imagePreview').style.display="none"; 
                state.tempImg="";
                btn.disabled = false; btn.innerText = "Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ";
            })
            .catch(err => {
                alert("âŒ ÙØ´Ù„: " + err.message);
                btn.disabled = false; btn.innerText = "Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ";
            });
        } else {
            alert("âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø³Ø¹Ø±");
        }
    }

    function order(id) {
        const p = state.products.find(x => x.id == id);
        const ph = prompt("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨:", state.account.phone || "");
        if(ph) {
            const ordId = db.ref().child('orders').push().key;
            db.ref('orders/' + ordId).set({
                id: ordId, pName: p.name, phone: ph, time: new Date().toLocaleString(), status: 'Ø¬Ø¯ÙŠØ¯'
            }).then(() => alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ù„Ù„Ù…ÙˆØ±Ø¯!"));
        }
    }

    function del(id) { 
        if(confirm("Ø­Ø°Ù Ø§Ù„Ù…Ø§Ø¯Ø©ØŸ")) {
            db.ref('products/' + id).remove();
        }
    }

    function saveAccount() {
        state.account = {
            role: state.account.role,
            name: document.getElementById('userName').value,
            phone: document.getElementById('userPhone').value,
            city: document.getElementById('userCity').value,
            addr: document.getElementById('userAddress').value,
            bName: document.getElementById('businessName').value
        };
        localStorage.setItem('m_account', JSON.stringify(state.account));
        db.ref('users/' + state.account.phone).set(state.account);
        document.getElementById('saveMsg').style.display = 'block';
        setTimeout(() => document.getElementById('saveMsg').style.display = 'none', 3000);
    }

    function render(filter = 'Ø§Ù„ÙƒÙ„') {
        state.currentFilter = filter;
        const filtered = filter === 'Ø§Ù„ÙƒÙ„' ? state.products : state.products.filter(p => p.cat === filter);
        
        const cardHtml = (p, adm) => `
            <div class="card">
                ${adm ? `<button class="delete-btn" onclick="del('${p.id}')">Ø­Ø°Ù</button>` : ''}
                <img src="${p.img}">
                <div class="card-body">
                    <div class="p-name">${p.name}</div>
                    <span class="p-price-num">${Number(p.price).toLocaleString()} Ø¯.Ø¹</span>
                    ${!adm ? `<button class="btn-submit" style="padding:8px; font-size:12px; margin-top:5px" onclick="order('${p.id}')">Ø§Ø·Ù„Ø¨</button>` : ''}
                </div>
            </div>`;

        document.getElementById('mainGrid').innerHTML = filtered.map(p => cardHtml(p, false)).join('');
        document.getElementById('adminGrid').innerHTML = state.products.map(p => cardHtml(p, true)).join('');
    }

    function renderOrders() {
        document.getElementById('ordersList').innerHTML = state.orders.map(o => `
            <div style="background:white; padding:15px; border-radius:12px; margin-bottom:10px; border-right:5px solid var(--accent); box-shadow: var(--shadow);">
                <b>ğŸ“¦ ${o.pName}</b><br><small>ğŸ“± ${o.phone} | â° ${o.time}</small>
                <div style="margin-top:10px">
                    <a href="tel:${o.phone}" style="color:green; text-decoration:none; font-weight:bold; font-size:14px;">ğŸ“ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø²Ø¨ÙˆÙ†</a>
                </div>
            </div>`).join('');
    }

    function switchView(id, btn) {
        document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        btn.classList.add('active');
    }

    function filterData(c, b) {
        document.querySelectorAll('.tab-btn').forEach(t => t.classList.remove('active'));
        b.classList.add('active');
        render(c);
    }

    function setRole(r, b) { 
        state.account.role = r; 
        document.querySelectorAll('.role-btn').forEach(x => x.classList.remove('active'));
        b.classList.add('active');
        document.getElementById('businessDetails').style.display = (r === 'customer') ? 'none' : 'block';
    }

    window.onload = function() {
        const acc = state.account;
        if(acc && acc.name) {
            document.getElementById('userName').value = acc.name || "";
            document.getElementById('userPhone').value = acc.phone || "";
            document.getElementById('userCity').value = acc.city || "Ø¨ØºØ¯Ø§Ø¯";
            document.getElementById('userAddress').value = acc.addr || "";
            document.getElementById('businessName').value = acc.bName || "";
            if(acc.role) {
                const roleBtn = document.getElementById('role-' + acc.role);
                if(roleBtn) setRole(acc.role, roleBtn);
            }
        }
        render();
    };
</script>
</body>
</html>
